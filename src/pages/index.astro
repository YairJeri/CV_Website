---
import Layout from "../layouts/layout.astro";
import About from "../components/about.astro";
import Home from "../components/home.astro";
import Stats from "../components/stats.jsx";
import Skills from "../components/skills.jsx";
import Portfolio from "../components/portfolio.jsx";

import { getCollection } from "astro:content";
import { getImage } from "astro:assets";

const projectsRaw = await getCollection("portfolio");

const projects = await Promise.all(
    projectsRaw.map(async (p) => {
        const optimizedImage = await getImage({
            src: p.data.image,
            format: "webp",
        });

        return {
            ...p,
            optimizedImage,
        };
    }),
);
---

<Layout title="Yair Jeri's CV">
    <Home />
    <About />
    <Stats client:visible />
    <Skills client:visible />
    <Portfolio projects={projects} client:visible />
</Layout>
